<!--
********************************************************************************
Jimm - Mobile Messaging - J2ME ICQ clone
Copyright (C) 2003-04  Jimm Project

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; either version 2
of the License, or (at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.
********************************************************************************
File: util/build-release.xml
Version: ###VERSION###  Date: ###DATE###
Author(s): Manuel Linsmayer, Andreas Rossbacher
********************************************************************************
-->

<project name="Jimm" default="release-part1">

	<!-- ********************************************************************* -->
	<!-- CONFIGURATION SECTION - CHANGE VALUES TO REFLECT YOUR LOCAL ENV.      -->
	<!-- ********************************************************************* -->
	<property name="DEFAULT/midp"      value="CHANGE ME"                        />
	<property name="DEFAULT/midp/lib"  value="${DEFAULT/midp}/lib/midp.jar"     />
	<property name="SIEMENS/midp"      value="CHANGE ME"                        />
	<property name="SIEMENS/midp/lib"  value="${SIEMENS/midp}/lib/api.jar"      />
	<property name="RIM/midp"          value="CHANGE ME"                        />
	<property name="RIM/midp/lib"      value="${RIM/midp}/lib/net_rim_api.jar"  />
	<property name="proguard"          value="CHANGE ME"                        />
	<property name="proguard/lib"      value="${proguard}/lib/proguard.jar"     />
	<!-- ********************************************************************* -->
	<!-- RELEASE VERSION SECTION - EVERY RELEASE HAS A UNIQUE VERSION NUMBER   -->
	<!-- ********************************************************************* -->
	<property name="version"           value="0.2"                              />
	<property name="version/java"      value="0.1"                              />
	<!-- ********************************************************************* -->
	<!-- CHANGE NOTHING BELOW THIS LINE, UNLESS YOU KNOW WHAT YOU'RE DOING     -->
	<!-- ********************************************************************* -->

	<!-- Buildfile description -->
	<description>This buildfile is used to build a Jimm release.</description>

	<!-- Set global properties for this build -->
	<property name="cvsroot" value=":pserver:anonymous@cvs.sourceforge.net:/cvsroot/jimm"/>
	<property name="cvsdir" location="cvs"/>
	<property name="package" value="jimm"/>
	<property name="bin" value="bin"/>
	<property name="targetlist" value="DEFAULT;SIEMENS;MIDP2"/>
	<property name="connectionlist" value="RAWSOCKET"/>
	<property name="langlist" value="EN,DE,RU,ES,BR,CZ,SE,LT,IT;EN,DE;EN,RU;EN,ES;EN,BR;EN,CZ;EN,SE;EN,LT;EN,IT;EN;DE;RU;ES;BR;CZ;SE;LT;IT"/>

	<!-- Auxiliary property -->
	<property name="3ns" value="###"/>

	<!-- Include Ant-Contrib Tasks -->
	<taskdef resource="net/sf/antcontrib/antcontrib.properties"/>

	<!-- Internal target: init -->
	<target name="init">
		<tstamp>
			<format property="date"
				pattern="yyyy/MM/dd"
				timezone="GMT+00:00"/>
		</tstamp>
		<tstamp>
			<format property="touchdate"
				pattern="MM/dd/yyyy"
				timezone="GMT+00:00"/>
		</tstamp>
	</target>

	<!-- Internal target: export -->
	<target name="export" depends="init">
		<mkdir dir="${cvsdir}"/>
		<cvs command="export"
			cvsRoot="${cvsroot}"
			dest="${cvsdir}"
			package="${package}"
			date="tomorrow"
			failonerror="true"/>
	</target>

	<!-- Internal targets: build/build-target/build-target-connection/build-target-connection-lang -->
	<target name="build" depends="export">
		<foreach list="${targetlist}"
			target="build-target"
			param="target"
			delimiter=";"
			inheritall="true"/>
	</target>
	<target name="build-target">
		<foreach list="${connectionlist}"
			target="build-target-connection"
			param="connection"
			delimiter=";"
			inheritall="true"/>
	</target>
	<target name="build-target-connection">
		<foreach list="${langlist}"
			target="build-target-connection-lang"
			param="lang"
			delimiter=";"
			inheritall="true"/>
	</target>
	<target name="build-target-connection-lang">
		<antcall target="dist"/>
	</target>

	<!-- Internal target: dist -->
	<target name="dist">
		<propertycopy name="midp" from="${target}/midp"/>
		<propertycopy name="midp/lib" from="${target}/midp/lib"/>
		<ant dir="${cvsdir}/${package}"
			inheritAll="false">
			<property name="midp"         value="${midp}"/>
			<property name="midp/lib"     value="${midp/lib}"/>
			<property name="proguard"     value="${proguard}"/>
			<property name="proguard/lib" value="${proguard/lib}"/>
			<property name="target"       value="${target}"/>
			<property name="connection"   value="${connection}"/>
			<property name="lang"         value="${lang}"/>
			<property name="version"      value="${version}"/>
			<property name="version/java" value="${version/java}"/>
		</ant>
		<mkdir dir="${cvsdir}/${package}/${bin}/${target}/${lang}"/>
		<copy file="${cvsdir}/${package}/dist/bin/Jimm.jad"
			todir="${cvsdir}/${package}/${bin}/${target}/${lang}"/>
		<copy file="${cvsdir}/${package}/dist/bin/Jimm.jar"
			todir="${cvsdir}/${package}/${bin}/${target}/${lang}"/>
		<ant dir="${cvsdir}/${package}"
			target="clean"
			inheritAll="false">
			<property name="midp"         value="${midp}"/>
			<property name="midp/lib"     value="${midp/lib}"/>
			<property name="proguard"     value="${proguard}"/>
			<property name="proguard/lib" value="${proguard/lib}"/>
			<property name="target"       value="${target}"/>
			<property name="connection"   value="${connection}"/>
			<property name="lang"         value="${lang}"/>
			<property name="version"      value="${version}"/>
			<property name="version/java" value="${version/java}"/>
		</ant>
	</target>

	<!-- Target: release-part1 -->
	<target name="release-part1" description="Generates the release (part 1)">
		<antcall target="build"/>
		<echo message="Build target release-part2 to complete build process!"/>
	</target>

	<!-- Target: release-part2 -->
	<target name="release-part2" depends="init" description="Generate the release (part 2)">
		<ant dir="${cvsdir}/${package}/util/sijapp"
			target="clean"
			inheritAll="false"/>
		<ant dir="${cvsdir}/${package}/util/jarsizetask"
			target="clean"
			inheritAll="false"/>
		<replace dir="${cvsdir}/${package}"
			encoding="UTF-8">
			<replacefilter token="${3ns}VERSION${3ns}"
				value="${version}"/>
			<replacefilter token="${3ns}VERSION-JAVA${3ns}"
				value="${version/java}"/>
			<replacefilter token="${3ns}DATE${3ns}"
				value="${date}"/>
		</replace>
		<move todir="${cvsdir}/${package}-${version}">
			<fileset dir="${cvsdir}/${package}"/>
		</move>
		<touch datetime="${touchdate} 00:00 AM">
			<fileset dir="${cvsdir}/${package}-${version}"/>
		</touch>
		<zip destfile="${package}-${version}.zip"
			basedir="${cvsdir}"/>
		<tar destfile="${package}-${version}.tar.gz"
			basedir="${cvsdir}"
			compression="gzip"/>
		<tar destfile="${package}-${version}.tar.bz2"
			basedir="${cvsdir}"
			compression="bzip2"/>
		<touch file="${package}-${version}.zip"
			datetime="${touchdate} 00:00 AM"/>
		<touch file="${package}-${version}.tar.gz"
			datetime="${touchdate} 00:00 AM"/>
		<touch file="${package}-${version}.tar.bz2"
			datetime="${touchdate} 00:00 AM"/>
  	</target>

	<!-- Target: clean -->
	<target name="clean" description="Delete the release">
		<delete dir="${cvsdir}"/>
		<delete file="${package}-${version}.zip"/>
		<delete file="${package}-${version}.tar.gz"/>
		<delete file="${package}-${version}.tar.bz2"/>
	</target>

</project>
